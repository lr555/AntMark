{% extends 'home/base.html' %}
{% load staticfiles %}
{% block content %}
<style>
    #line-limit-length {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 200px;
    }
</style>

<div class="container">
    {% include 'commodity/upslider.html' %}
    <br>
    <div class="row clearfix">
        {% for commodity in commodities %}
        <div class="col-md-3 column">
            <div class="single-feature mb-30">
                {% if commodity.image %}
                <img src="{{commodity.image | striptags}}" height="200px" class="center-block">
                {% else %}
                <img src="{% static 'img/defaultImage.jpg' %}" height="200px" class="center-block">
                {% endif %}
                <div class="title d-flex flex-row pb-20">
                    <span class="glyphicon glyphicon-gift"></span>
                    <h5 id="line-limit-length"><a href="{% url 'commodity:commodity_detail' commodity.id %}">{{commodity.title}}</a></h5>
                </div>
                <p id="line-limit-length">待售：{{commodity.for_sale}}</p>
                <p id="line-limit-length">标签：{{commodity.commodity_tag.all|join:","}}</p>
                <p id="line-limit-length">货源：{{commodity.commodity_source.all|join:","}}</p>
                <p id="line-limit-length">价格：￥{{commodity.price}}</p>
                <p id="line-limit-length">数量：{{commodity.amount}}</p>
                <a name="preview" href="{% url 'commodity:preview_commodity' commodity.id %}">
                    <button type="button" class="btn btn-default" >预览</button>
                </a>
                <a name="edit" href="{% url 'commodity:edit_commodity' commodity.id %}">
                    <button type="button" class="btn btn-default" style="margin-left:0px">编辑</button>
                </a>
                <a name="delete" href="javascript:" onclick="del_commodity(this, {{commodity.id}})">
                    <button type="button" class="btn btn-default" style="margin-left:0px">删除</button>
                </a>
                <a name="verify" href="#">
                    <button type="button" class="btn btn-default" style="margin-left:0px">提交审核</button>
                </a>      
            </div>
        </div>
        {% empty %}
        <p>您所有的商品已经通过审核了哦~</p>
        {% endfor %}
    </div>
</div>

<script src="{% static 'js/jquery.js' %}"></script>
<script src="{% static 'js/layer.js' %}"></script>
<script src="{% static 'js/json2.js' %}"></script>
<script type="text/javascript">
    function del_commodity(the, commodity_id) {
        var commodity_name = $(the).parents("div").children("div").children("h4").text();
        // var commodity_name = $(the).parents("div").children("h4").text();
        layer.open({
            type: 1,
            skin: "layui-layer-rim",
            area: ["400px", "200px"],
            title: "删除商品",
            content: '<div class="text-center" style="margin-top:20px"><p>是否确定删除商品：' + commodity_name +
                '</p> </div>',
            btn: ['确定', '取消'],
            yes: function () {
                $.ajax({
                    url: '{% url "commodity:del_commodity" %}',
                    type: "POST",
                    data: {
                        "commodity_id": commodity_id
                    },
                    success: function (e) {
                        if (e == "1") {
                            parent.location.reload();
                            layer.msg("has been deleted.");
                        } else {
                            layer.msg("删除失败");
                        }
                    },
                })
            },
        });
    }
</script>
<script>
    var temp = document.getElementById("upslider5");
    temp.classList.add("active");
</script>
{% endblock %}